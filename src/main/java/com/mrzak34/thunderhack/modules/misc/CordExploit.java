package com.mrzak34.thunderhack.modules.misc;

import com.mrzak34.thunderhack.event.events.PacketEvent;
import com.mrzak34.thunderhack.command.Command;
import com.mrzak34.thunderhack.modules.Module;
import com.mrzak34.thunderhack.setting.Setting;
import net.minecraft.entity.Entity;
import net.minecraft.entity.passive.EntityWolf;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.init.SoundEvents;
import net.minecraft.network.play.server.SPacketEffect;
import net.minecraft.network.play.server.SPacketEntityTeleport;
import net.minecraft.network.play.server.SPacketSoundEffect;
import net.minecraft.util.math.BlockPos;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class CordExploit extends Module {

    public CordExploit() {
        super("CordExploit", "звуковые эксплоиты", Category.MISC, true, false, false);
    }




    public Setting<Boolean> BossDetector = register(new Setting("BossDetector", true));
    public Setting<Boolean> logLightning = register(new Setting("Lightning", true));
    public Setting<Boolean> logWolf = register(new Setting("Wolf", true));
    public Setting<Boolean> logPlayer = register(new Setting("Player", true));
    public Setting <Integer> minLightningDist = this.register ( new Setting <> ( "minLightningDist", 32, 0, 100, v->logLightning.getValue() ) );
    public Setting <Integer> minWolfDist = this.register ( new Setting <> ( "minWolfDist", 256, 0, 1024, v->logWolf.getValue() ) );
    public Setting <Integer> minPlayerDist = this.register ( new Setting <> ( "minPlayerDist", 256, 0, 1024, v->logPlayer.getValue() ) );

    private boolean pastDistance(EntityPlayer player, BlockPos pos, double dist) {
        return player.getDistanceSqToCenter(pos) >= Math.pow(dist, 2);
    }


    @SubscribeEvent
    public void onPacketReceive(PacketEvent.Receive e) {
        if (BossDetector.getValue()) {
            if (e.getPacket() instanceof SPacketEffect) {
                SPacketEffect sPacketEffect = (SPacketEffect) e.getPacket();
                BlockPos pos = new BlockPos(sPacketEffect.getSoundPos().x, sPacketEffect.getSoundPos().y, sPacketEffect.getSoundPos().z);

                switch (sPacketEffect.getSoundType()) {
                    case 1023: {
                        Command.sendMessage("Wither Spawned " + pos.x + " Y:" + pos.y + " Z:" + pos.z);
                        break;
                    }
                    case 1028: {
                        Command.sendMessage("Ender Dragon Defeated " + pos.x + " Y:" + pos.y + " Z:" + pos.z);
                        break;
                    }
                    case 1038: {
                        Command.sendMessage("End Portal Activated " + pos.x + " Y:" + pos.y + " Z:" + pos.z);
                        break;
                    }
                }
            }
        }

        if (logLightning.getValue() && e.getPacket() instanceof SPacketSoundEffect) {
            SPacketSoundEffect packet2 = (SPacketSoundEffect) e.getPacket();

            if (packet2.getSound() != SoundEvents.ENTITY_LIGHTNING_THUNDER) {
                return;
            }

            BlockPos pos = new BlockPos(packet2.getX(), packet2.getY(), packet2.getZ());

            if (pastDistance(mc.player, pos, minLightningDist.getValue())) {
                Command.sendMessage("Lightning strike At X:" + pos.x + " Y:" + pos.y + " Z:" + pos.z);
            }
        } else if (e.getPacket() instanceof SPacketEntityTeleport) {
            SPacketEntityTeleport sPacketEntityTeleport = (SPacketEntityTeleport) e.getPacket();
            Entity teleporting = mc.world.getEntityByID(sPacketEntityTeleport.getEntityId());
            BlockPos pos = new BlockPos(sPacketEntityTeleport.getX(), sPacketEntityTeleport.getY(), sPacketEntityTeleport.getZ());

            if (logWolf.getValue() && teleporting instanceof EntityWolf) {
                if (pastDistance(mc.player, pos, minWolfDist.getValue())) {
                    Command.sendMessage("Wolf Teleport At X:" + pos.x + " Y:" + pos.y + " Z:" + pos.z);
                }
            } else if (logPlayer.getValue() && teleporting instanceof EntityPlayer) {
                if (pastDistance(mc.player, pos, minPlayerDist.getValue())) {
                    Command.sendMessage(teleporting.getName() + " Teleported to X:" + pos.x + " Y:" + pos.y + " Z:" + pos.z);
                }
            }
        }
    }

}
